Description: Prevent IPv6 netmask-based address matching logic from incorrectly
 being applied to IPv4 addresses.
Author: Todd C. Miller <Todd.Miller@courtesan.com>

Index: sudo-1.8.3p1/plugins/sudoers/match_addr.c
===================================================================
--- sudo-1.8.3p1.orig/plugins/sudoers/match_addr.c	2011-10-21 08:01:25.000000000 -0500
+++ sudo-1.8.3p1/plugins/sudoers/match_addr.c	2012-05-14 17:32:51.238898833 -0500
@@ -73,7 +73,7 @@
     for (ifp = interfaces; ifp != NULL; ifp = ifp->next) {
 	if (ifp->family != family)
 	    continue;
-	switch(family) {
+	switch (family) {
 	    case AF_INET:
 		if (ifp->addr.ip4.s_addr == addr.ip4.s_addr ||
 		    (ifp->addr.ip4.s_addr & ifp->netmask.ip4.s_addr)
@@ -91,6 +91,7 @@
 		}
 		if (j == sizeof(addr.ip6.s6_addr))
 		    return TRUE;
+		break;
 #endif
 	}
     }
@@ -154,10 +155,11 @@
     for (ifp = interfaces; ifp != NULL; ifp = ifp->next) {
 	if (ifp->family != family)
 	    continue;
-	switch(family) {
+	switch (family) {
 	    case AF_INET:
 		if ((ifp->addr.ip4.s_addr & mask.ip4.s_addr) == addr.ip4.s_addr)
 		    return TRUE;
+		break;
 #ifdef HAVE_IN6_ADDR
 	    case AF_INET6:
 		for (j = 0; j < sizeof(addr.ip6.s6_addr); j++) {
@@ -166,6 +168,7 @@
 		}
 		if (j == sizeof(addr.ip6.s6_addr))
 		    return TRUE;
+		break;
 #endif /* HAVE_IN6_ADDR */
 	}
     }
